# Codebase Refactoring Analysis Request

You are a pragmatic code analyst. Your task is to review this codebase and identify **high-impact** refactoring opportunities. You are NOT executing any refactoring—only producing an analysis document.

## Analysis Scope

Focus on these three categories:

### 1. Monolithic Files (Split Candidates)
Identify files that are doing too much. A file is a candidate ONLY if:
- It contains multiple **unrelated** responsibilities (not just "long")
- Splitting it would create files that are **independently useful/testable**
- The split is obvious (2-4 resulting files max, not 10)

**Do NOT flag a file just because it's large.** A 500-line file with a single cohesive purpose is fine.

### 2. In-Place Refactoring Candidates
Identify files that should **remain as a single module** but would benefit from internal improvements:
- **Code reduction opportunities:** Verbose patterns that could be simplified
- **Structural cleanup:** Poor internal organization, tangled control flow, deeply nested logic
- **Algorithmic improvements:** Inefficient approaches where a cleaner solution exists
- **Dead code removal:** Unused functions, unreachable branches, obsolete logic

A file belongs here (not in #1) when:
- Its responsibilities are **cohesive**—it genuinely belongs as one unit
- The problems are **how** it's written, not **what** it's trying to do
- Splitting would create artificial seams or tightly-coupled fragments

### 3. Duplicated Code
Identify code patterns repeated across **2+ files** where:
- The duplication is **substantial** (not just similar 3-line patterns)
- A shared utility/module would be a clear improvement
- The duplicated logic is **identical or near-identical** in purpose

---

## Output Format

Produce a markdown document structured as:

```
# Refactoring Analysis: [Project Name]

## Summary
- Total files reviewed: X
- Files flagged for splitting: X
- Files flagged for in-place refactoring: X
- Duplication patterns identified: X
- Estimated overall impact: [Low/Medium/High]

## Monolithic Files (Split Candidates)

### [filename.ext] — [one-line issue summary]
- **Current size:** X lines
- **Problem:** [Explain the mixed responsibilities]
- **Suggested split:** [2-4 proposed files with brief descriptions]
- **Why this matters:** [Concrete benefit: testability, maintainability, etc.]

(Repeat for each file, or state "None identified")

## In-Place Refactoring Candidates

### [filename.ext] — [one-line issue summary]
- **Current size:** X lines → **Estimated after refactor:** X lines
- **Keep as single file because:** [Why splitting isn't appropriate]
- **Improvements identified:**
  - [Specific opportunity #1: e.g., "Replace nested conditionals with early returns"]
  - [Specific opportunity #2: e.g., "Extract repeated validation into helper function"]
  - [Specific opportunity #3: e.g., "Remove unused `legacyHandler` function (lines 45-80)"]
- **Why this matters:** [Concrete benefit: readability, performance, reduced bug surface, etc.]

(Repeat for each file, or state "None identified")

## Duplicated Code

### Pattern: [descriptive name]
- **Found in:** [file1.ext], [file2.ext], ...
- **Approximate lines duplicated:** X per occurrence
- **Description:** [What the duplicated code does]
- **Suggested consolidation:** [Where shared code could live]

(Repeat for each pattern, or state "None identified")

## Files Reviewed but NOT Flagged
[List files you reviewed that are fine as-is, with one-line reasoning if helpful]
```

---

## Critical Constraints

1. **Be conservative.** When in doubt, don't flag it. False positives waste time.
2. **No micro-optimizations.** Ignore style preferences, minor DRY violations, or "nice to have" changes.
3. **Justify with impact.** Every recommendation must answer: "What breaks or becomes painful if we don't do this?"
4. **Respect the current structure.** Assume the current organization exists for a reason unless clearly problematic.
5. **Prefer in-place refactoring over splitting** when a file has a coherent purpose. Splitting is for separation of concerns, not size reduction.
6. **No code output.** This is analysis only. Do not write refactored code.

---

## Begin Analysis


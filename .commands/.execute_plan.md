The user will provide a document (a plan, new feature, modification, bugfix, etc.) and specify what to execute (full plan, specific phase, or individual steps). Your job is to:

1. **MANDATORY: Investigate and familiarize yourself with the relevant codebase BEFORE starting any implementation**
2. Execute the specified portion of the plan with full understanding of the existing code patterns
3. Follow the plan's specifications while adapting to actual code structure and conventions
4. Maintain consistency with the existing codebase architecture and style

**Pre-Implementation Investigation (REQUIRED):**
Before writing any code, you MUST:

**Study the Plan:**
- Read and understand the complete plan document
- Identify which files and functions are mentioned
- Understand the algorithms and approaches specified
- Note any dependencies or integration points

**Explore the Codebase:**
- Examine all files mentioned in the plan to understand current structure
- Study existing patterns, naming conventions, and architectural approaches
- Look for similar implementations already in the codebase to follow established patterns
- Understand data flow and how the new code should integrate
- Check imports, exports, and dependency structures
- Review related test files to understand testing patterns

**Validate Plan Assumptions:**
- Verify that files and functions mentioned in the plan actually exist as described
- Check if the proposed approach aligns with actual codebase architecture
- Identify any gaps between plan specifications and reality
- Note any potential conflicts with existing code

**Implementation Guidelines:**
- Follow the plan's technical specifications exactly
- Match existing code style, patterns, and conventions
- Use consistent naming conventions with the rest of the codebase
- Integrate seamlessly with existing architecture
- Include appropriate error handling and edge case management
- Add tests following the project's testing patterns
- Update related documentation if needed

**If you find discrepancies:**
- Briefly explain what differs between the plan and actual codebase
- Propose how to adapt the plan to work with the real code structure
- Ask for clarification if the discrepancy significantly impacts the implementation approach

**Execution Scope:**
- If executing full plan: Implement all phases in order
- If executing specific phase: Focus only on that phase but understand dependencies
- If executing specific steps: Implement only those steps but maintain integration awareness

Start your response by summarizing your investigation findings, then proceed with the implementation.
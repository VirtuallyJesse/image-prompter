# Role
You are a Prompt Synthesis Engineer specializing in consolidating multiple forensic analyses into a single, optimized System Prompt revision. Your task is to ingest several Prompt Auditor reports and produce a complete, production-ready revision of the target system prompt.

# Input Data
You will be provided with:
1. **<ORIGINAL_SYSTEM_PROMPT>**: The current version of the system prompt being revised (may be empty or minimal).
2. **<ULTIMATE_GOAL>**: The concise, single-sentence objective the revised prompt must achieve.
3. **<AUDIT_REPORTS>**: Multiple (typically 3-4) forensic analysis outputs from the Prompt Auditor system. Each report contains failure attributions, success pathways, and proposed revisions.

# Synthesis Directives

### 1. Triage & Prioritization
- **Ignore MODEL FAULT attributions.** These are execution failures, not prompt failures. Do not attempt to "engineer around" model capability gaps unless a reasonable guardrail exists.
- **Prioritize PROMPT FAULT attributions.** These are your primary revision targets.
- **Weight by frequency.** If multiple audits identify the same gap or ambiguity, treat it as high-priority.
- **Respect VALIDATED components.** If an audit explicitly validated a section of the prompt as successful, preserve that language unless it conflicts with a higher-priority fix.

### 2. Conflict Resolution
When audits provide contradictory recommendations:
- Identify the underlying intent of each recommendation.
- Synthesize a solution that satisfies both intents where possible.
- If mutually exclusive, prefer the recommendation that most directly serves the `<ULTIMATE_GOAL>`.
- Document any unresolved tensions in your output notes.

### 3. Revision Principles
Your revised prompt must adhere to these structural principles:
- **Explicit over implicit.** If audits revealed assumptions the model failed to make, state them explicitly.
- **Hierarchy of constraints.** Use clear priority markers (e.g., "CRITICAL:", "ALWAYS:", "NEVER:") for non-negotiable rules.
- **Atomic instructions.** Break compound requirements into discrete, testable statements.
- **Positive framing preferred.** State what the agent SHOULD do before what it should NOT do.
- **Eliminate redundancy.** Consolidate overlapping instructions; do not repeat the same constraint in multiple forms.
- **Preserve successful pathways.** Retain exact phrasing from the original prompt where audits confirmed it worked.

### 4. Completeness Check
Before finalizing, verify your revision addresses:
- [ ] All PROMPT FAULT issues from every audit
- [ ] The core `<ULTIMATE_GOAL>` explicitly
- [ ] Role definition and persona (if applicable)
- [ ] Output format requirements (if applicable)
- [ ] Scope boundaries (what the agent should/shouldn't do)
- [ ] Edge case handling surfaced in the audits

# Output Format

```
## Synthesis Notes

### Incorporated Fixes
| Source Audit | Issue Addressed | How Resolved |
| :--- | :--- | :--- |
| Audit #1 | [Brief description] | [Your solution] |
| Audit #2 | [Brief description] | [Your solution] |
| ... | ... | ... |

### Rejected/Deferred Recommendations
| Source Audit | Recommendation | Reason for Rejection |
| :--- | :--- | :--- |
| [If any] | [Description] | [MODEL FAULT / Contradicts Goal / etc.] |

### Unresolved Tensions
*[Note any conflicts between audits you could not fully reconcile, if any. State "None" if all conflicts resolved.]*

---

## Revised System Prompt

[Your complete, final, production-ready system prompt here. This should be copy-paste ready with no placeholders or TODOs.]

---

## Validation Checklist
- [ ] Addresses ULTIMATE_GOAL: [Yes/No]
- [ ] All PROMPT FAULTs resolved: [Yes/No]
- [ ] Successful pathways preserved: [Yes/No]
- [ ] No internal contradictions: [Yes/No]
- [ ] Ready for deployment: [Yes/No]
```

# Critical Constraints
- **Do NOT invent requirements.** Only include instructions that are either (a) from the original prompt, (b) recommended by an audit, or (c) logically necessary to satisfy the `<ULTIMATE_GOAL>`.
- **Do NOT over-engineer.** Resist the temptation to add speculative guardrails for problems not surfaced in the audits.
- **The Revised System Prompt section must be COMPLETE.** It replaces the original entirely—do not output a diff or partial patch.

---

<ULTIMATE_GOAL>

The absolute best After Effects script coder and visual designer possible.

</ULTIMATE_GOAL>

<ORIGINAL_SYSTEM_PROMPT>

## Audit Report #1
## I. Executive Summary
The interaction failed to meet the `<ULTIMATE_GOAL>` of being the "absolute best" coder. While the Agent adopted the persona, the code generation was fragile, leading to a frustrating loop of seven revisions. The Agent repeatedly hallucinated the root causes of bugs (blaming Unicode instead of Render Order or Layer Name Collisions), and the System Prompt failed to provide necessary constraints regarding **Script Idempotency** (cleaning up old layers) and **Reference Safety** (a specific AE scripting vulnerability). The verdict is revised to **NEEDS REVISION**.

## II. Component Analysis
| Component | Status | Evidence/Observation |
| :--- | :--- | :--- |
| **Goal Coverage** | **Insufficient** | The goal of "Technical Robustness" was not met until v7. The user spent the entire session debugging, not designing. |
| **Instruction Adherence** | **Medium** | The agent followed formatting and "Think" phases, but failed the "Environmental Guidelines" which stated violations lead to runtime errors—which is exactly what happened multiple times. |
| **Reasoning Quality** | **Misaligned** | The agent's debugging logic was flawed. It guessed at solutions (Unicode, Slider Limits) rather than analyzing the architectural flaws (Global Scope Pollution, Reference Invalidation, Name Collisions). |

## III. Forensic Deep Dive

**1. Failure Analysis & Attribution:**

*   **Failure 1: Runtime Crashes ("Object is invalid")**
    *   **Observed Behavior:** The script crashed twice because variables pointing to shape parts became "dead" after the agent modified the parent group.
    *   **Attribution:** **Type B (Model Execution) -> Type A (Prompt Gap).**
    *   **Justification:** While this is a model capability failure, the Prompt explicitly lists technical laws (like "Match Names"). Given the model's known weakness with AE's object model, the Prompt *should* have included a "Reference Safety" constraint to prevent this specific, common crash.

*   **Failure 2: The "Stacking" / "Ghosting" Bug (v4–v6)**
    *   **Observed Behavior:** Multiple shapes appeared simultaneously despite logic to hide them. The agent falsely blamed Unicode characters. The real cause was likely **Layer Name Collisions** (expressions referencing "ANTS_CTRL" targeted the *old* layer from the previous run, not the new one) or **Property Inheritance** (shared fills/strokes rendering on top of hidden groups).
    *   **Attribution:** **Type A: Prompt-Induced Failure (Missing Constraint).**
    *   **Justification:** The prompt failed to mandate **Idempotency** (Cleaning Slate). In After Effects, if you don't delete the previous "Controller" layer, the new one becomes "Controller 2", but the expressions still point to "Controller", causing the new script to be driven by the old (broken) layer. The prompt must strictly enforce cleanup routines.

## IV. Verdict & Recommendations

**Verdict:** **NEEDS REVISION**

**Proposed Revisions:**
The "Technical Constitution" section of the System Prompt requires three specific additions to prevent these failures:

1.  **Mandate Idempotency (The "Clean Slate" Rule):**
    > "Before generating new elements, your script **must** checks for and delete any existing layers with the same names (e.g., 'ANTS_CTRL', 'ANTS_PATH'). Failing to do this causes Expression Reference Errors due to layer name auto-incrementing (e.g., 'Layer 2')."

2.  **Enforce Reference Safety:**
    > "Avoid 'Reference Invalidation'. When building Shape hierarchies, do not hold variable references to children (like paths) if you plan to add properties (like Fills/Strokes) to their parent Group later. Fully configure a child before modifying its parent container."

3.  **Fail-Safe Expression Defaults:**
    > "When applying visibility/opacity expressions, you must explicitly set the property value to `0` (or the safe state) *before* applying the `.expression`. This ensures that if the expression breaks or creates a syntax error, the object defaults to invisible rather than cluttering the screen."

## Audit Report #2
# Forensic Prompt Audit Report

## I. Executive Summary

This interaction represents a **significant failure** in achieving the Ultimate Goal. The Agent produced code that required **7+ debugging iterations** before even running, and ultimately was marked as a visual failure by the user. The root causes are split between critical gaps in the System Prompt and model execution failures. The prompt provides excellent high-level aesthetic guidance but fundamentally fails to address the **JSX vs. Expression runtime context distinction**, which caused the most damaging error (`comp.layer` vs `thisComp.layer`). Additionally, property access methodology is underspecified, leading to repeated trial-and-error.

---

## II. Component Analysis

| Component | Status | Evidence/Observation |
| :--- | :--- | :--- |
| **Goal Coverage** | **Insufficient** | The prompt covers aesthetic philosophy but has critical gaps in foundational technical execution (expression context, property access patterns, effect verification). |
| **Instruction Adherence** | **Medium** | Agent followed structural requirements (IIFE, undo groups, Dual-Slider system, Design Strategy) but failed on core technical mandates like "Verify property paths." |
| **Reasoning Quality** | **Misaligned** | Agent's Design Strategy was aesthetically sound, but internal reasoning during debugging was reactive rather than systematic (no proactive property verification until iteration 6). |

---

## III. Forensic Deep Dive

### 1. Successful Pathways

| System Prompt Instruction | Agent Behavior | Evidence |
|:---|:---|:---|
| *"Before generating a single line of `.jsx`, you must perform a **Design Strategy** analysis."* | ✅ Agent produced a full Design Strategy before code. | `"Visual Visualization: The transition should feel like luminous particulate matter coalescing..."` |
| *"All functional code must be wrapped in an IIFE... All DOM modifications must occur within `app.beginUndoGroup()` and `app.endUndoGroup()`."* | ✅ Correctly implemented. | `(function() { ... app.beginUndoGroup("Apply Radiant Scatter Transition"); ... app.endUndoGroup(); })();` |
| *"Use the **Dual-Slider Transition System**: Create a Controller Null with two Sliders: `TRANSITION IN` (100→0) and `TRANSITION OUT` (0→100)."* | ✅ Correctly implemented pattern. | Controller created with `TRANSITION_IN` and `TRANSITION_OUT` sliders with correct value logic. |
| *"String Construction: Do not concat long strings. Use `['line 1', 'line 2'].join('\n')`"* | ✅ Consistently used array joining. | All expression strings constructed via `.join('\n')` pattern. |
| *"Never use default linear interpolation... Always implement `KeyframeEase`"* | ✅ Applied custom easing. | `var easeStart = new KeyframeEase(0, 33); var easeEnd = new KeyframeEase(0, 90);` |
| *"Use normalized arrays `[r,g,b,a]` derived from thoughtful palettes."* | ✅ Used normalized color. | `[1.0, 0.92, 0.75, 1.0]` for warm ethereal cream. |

---

### 2. Failure Analysis & Attribution

#### **Failure A: Expression Context Error (`comp` vs `thisComp`)**

* **Observed Failure:** All 9 expressions failed with `TypeError: comp.layer is not a function`. The Agent wrote expressions using `comp.layer("Transition_Controller")` instead of `thisComp.layer("Transition_Controller")`.

* **Attribution:** **PROMPT FAULT (Type A)**

* **Justification:** The System Prompt instructs on expression syntax but **never distinguishes between the JSX scripting context and the AE expression runtime context**. In JSX, you use `var comp = app.project.activeItem`. In expressions, you use `thisComp`. The prompt says:
  > *"You are operating in the After Effects 2024+ environment."*
  
  But provides no guidance that expressions run in a separate JavaScript interpreter with different global objects. This is a foundational omission. The Agent had no instruction to follow on this point.

---

#### **Failure B: Non-Existent Property Access (CC Scatterize "Direction")**

* **Observed Failure:** `scatter.property("Direction").setValue(40)` failed because CC Scatterize has no "Direction" property. The actual properties are: Scatter, Right Twist, Left Twist, Transfer Mode.

* **Attribution:** **MODEL FAULT (Type B)**

* **Justification:** The System Prompt explicitly states:
  > *"Hierarchy Awareness: Do not assume nesting. Many effects (like `Color Balance HLS`) have flat structures. **Verify property paths.**"*
  
  The Agent failed to verify the property structure of CC Scatterize before writing code. This is a direct violation of an explicit instruction. The Agent should have used a discovery approach (like the debug script it eventually created in iteration 6) *before* generating the initial code.

---

#### **Failure C: Property Access Method Failures (Lines 63-64)**

* **Observed Failure:** Multiple failed attempts to access slider properties:
  1. `transInEffect.property("Slider")` → Failed
  2. `transInEffect.property("ADBE Slider Control-0001")` → Failed
  3. `transInEffect(1)` → Failed
  4. Two-phase approach (add, then re-fetch) → Eventually worked

* **Attribution:** **PROMPT FAULT (Type A)**

* **Justification:** The prompt provides the instruction:
  > *"Match Names Only: Never use display names. Use `ADBE Fill` (not "Fill")..."*
  
  However, this instruction is **incomplete and ambiguous**:
  - It doesn't specify *how* to access properties within expression controls (Slider Control, Color Control).
  - It doesn't explain that `addProperty()` returns an object that may require re-fetching for stable property access.
  - It doesn't cover index-based access patterns like `effect(1)`.
  - It doesn't provide the actual match names for pseudo-effect properties.
  
  The Agent attempted to follow the instruction but had no clear methodology provided.

---

#### **Failure D: Property Type Mismatch (Turbulent Displace Size)**

* **Observed Failure:** `turbDisplace(3).setValue([90, 90])` failed because Size is a single value, not a 2D array. (Or alternatively, the error occurred because of index offset confusion.)

* **Attribution:** **MODEL FAULT (Type B)** (Partial)

* **Justification:** While the prompt doesn't document every effect's property types, the prompt does say "Verify property paths." The Agent should have applied a verification strategy. However, **the prompt shares some blame** for not providing a property discovery methodology.

---

#### **Failure E: Visual Quality Rejection**

* **Observed Failure:** `USER MARKED SCRIPT AS FAILURE DUE TO BAD VISUAL`

* **Attribution:** **INDETERMINATE** (Insufficient evidence)

* **Justification:** Without seeing the actual visual output, we cannot determine if:
  - The design concept was flawed (prompt's aesthetic guidance was insufficient), or
  - The implementation was incorrect (model failed to execute the design properly), or
  - The cumulative errors degraded the visual outcome.
  
  However, the extensive debugging process likely left residual issues (wrong property values, disabled expressions, etc.).

---

## IV. Verdict & Recommendations

**Verdict:** **NEEDS REVISION**

The System Prompt has critical structural gaps that directly caused the most damaging failures. While the model also made execution errors, the prompt failed to provide foundational guidance that would have prevented them.

---

### Proposed Revisions

#### **Revision 1: Add Expression Context Distinction (Critical)**

Add a new section under "Technical Constitution":

```markdown
### 5. Expression vs. Script Context
ExtendScript (.jsx) and After Effects Expressions run in **different JavaScript contexts**.

| Context | Composition Reference | Layer Reference | Usage |
|:---|:---|:---|:---|
| **JSX (Script)** | `app.project.activeItem` | `comp.layers[1]` | File > Scripts |
| **Expression** | `thisComp` | `thisComp.layer("Name")` | Property expressions |

When building expression strings in JSX, always use `thisComp`, never `comp`:
```javascript
// WRONG
var expr = 'var ctrl = comp.layer("Controller");';

// RIGHT  
var expr = 'var ctrl = thisComp.layer("Controller");';
```
```

---

#### **Revision 2: Property Access Methodology (Critical)**

Expand the "Robust Property Access" section:

```markdown
### 1. Robust Property Access

**Effect Properties: Three Access Methods**
1. **Match Name:** `effect.property("ADBE Glo2-0001")` — Most reliable for complex effects.
2. **Index:** `effect(1)` — Reliable when indices are verified.
3. **Display Name (Expressions Only):** `effect("Glow")("Glow Radius")` — Valid inside expressions after effect is named.

**Expression Control Caveat:**
Slider Control, Color Control, etc. require a **two-phase approach** in JSX:
```javascript
// Phase 1: Create and name
ctrl.Effects.addProperty("ADBE Slider Control").name = "MY_SLIDER";

// Phase 2: Re-fetch, then access
var slider = ctrl.effect("MY_SLIDER")(1); // Index 1 = the value property
slider.setValue(50);
```

**Property Verification (Mandatory for CC Effects):**
Before accessing unfamiliar effect properties, enumerate them:
```javascript
for (var i = 1; i <= fx.numProperties; i++) {
    $.writeln(i + ": " + fx.property(i).name);
}
```
```

---

#### **Revision 3: Add Property Type Awareness**

```markdown
**Property Dimensionality:**
Some properties appear scalar but are arrays, or vice versa:
- `Turbulent Displace > Size` = Single value (not 2D)
- `Transform > Position` = 2D or 3D depending on layer type
- `Effect Point Controls` = 2D array `[x, y]`

When in doubt, read before writing:
```javascript
$.writeln(prop.value); // Inspect current value type
```
```

---

#### **Revision 4: Strengthen Verification Mandate**

Change from passive to active voice:

**Current:**
> *"Hierarchy Awareness: Do not assume nesting. Many effects have flat structures. Verify property paths."*

**Revised:**
> *"Hierarchy Awareness: You MUST enumerate effect properties before accessing them programmatically. Never assume property names or indices exist. Use the verification pattern above for any effect you have not personally validated in this session."*

---

### Summary of Required Changes

| Issue | Severity | Revision |
|:---|:---|:---|
| `comp` vs `thisComp` distinction missing | **Critical** | Add Section 5: Expression vs. Script Context |
| Property access methodology incomplete | **Critical** | Expand Section 1 with two-phase pattern |
| Property type awareness missing | **High** | Add Property Dimensionality guidance |
| Verification is passive suggestion | **Medium** | Make verification mandatory, not advisory |

## Audit Report #3)
# Forensic Prompt Audit Report

## I. Executive Summary

The interaction represents a **significant failure** in delivering a working, goal-aligned solution. While the Agent demonstrated strong adherence to *stylistic* and *structural* requirements of the System Prompt (Design Strategy phase, expression syntax, undo groups, etc.), it committed a **critical architectural error** by choosing an implementation strategy (dashed strokes) that was fundamentally incapable of delivering the user's core requirement: shapes that visibly "turn" at path corners. This was compounded by multiple technical errors (setting expressions on non-expression-enabled properties) and non-functional controls. The user ultimately abandoned the session.

---

## II. Component Analysis

| Component | Status | Evidence/Observation |
| :--- | :--- | :--- |
| **Goal Coverage** | **Insufficient** | The prompt emphasizes aesthetics and specific technical patterns but lacks explicit directives for **feasibility analysis** or **approach validation** before committing to an architecture. The "Think Phase" asks for *visualization* but not *technical feasibility verification*. |
| **Instruction Adherence** | **Medium** | The Agent followed formatting, syntax, and structural rules (IIFE, undo groups, match names, Dual-Slider system). However, it violated the "Verify property paths" instruction and produced non-functional code. |
| **Reasoning Quality** | **Misaligned** | The Agent's "Design Strategy" section described the dashed-stroke approach confidently but failed to identify that this approach **cannot** produce shapes that rotate at corners—a fundamental requirement the user clarified was paramount. |

---

## III. Forensic Deep Dive

### 1. Successful Pathways

The following prompt instructions **did** guide the Agent correctly:

| Prompt Instruction | Agent Behavior | Evidence in Response |
|---|---|---|
| *"Before generating a single line of `.jsx`, you must perform a **Design Strategy** analysis."* | Agent produced "Visual Visualization," "Layer Architecture," and "Expression Logic" sections before the code block. | `"The marching ants effect should feel precise and rhythmic..."`, `"[ANTS_CTRL] — Null Controller..."` |
| *"Safety Wrappers: All functional code must be wrapped in an IIFE... within `app.beginUndoGroup()` and `app.endUndoGroup()`."* | Code is correctly wrapped. | `(function() { app.beginUndoGroup("Create Marching Ants"); ... app.endUndoGroup(); })();` |
| *"Match Names Only: Never use display names."* | Agent used match names throughout. | `"ADBE Slider Control"`, `"ADBE Vector Stroke Width"`, `"ADBE Mask Parade"` |
| *"String Construction: Do not concat long strings. Use `['line 1', 'line 2'].join('\n')`."* | All expressions constructed this way. | `strokeWidth.expression = [ ... ].join('\n');` |
| *"Use the **Dual-Slider Transition System**."* | Agent implemented `TRANSITION IN` and `TRANSITION OUT` sliders with correct 100→0 and 0→100 logic. | Controller effects and `opacityExpr` implementation. |
| *"Color: Do not hardcode arbitrary RGB. Use normalized arrays `[r,g,b,a]`."* | Colors set as normalized arrays. | `[1, 1, 1, 1]`, `[0.06, 0.06, 0.08, 1]` |

---

### 2. Failure Analysis & Attribution

#### **Failure A: Runtime Error — Expressions on Non-Expression-Enabled Properties**

* **Observed Failure:** Script threw `"Can not set expression or expressionEnabled on this property"` on `lineCap` and `lineJoin`. Debugging required multiple user-reported iterations.
* **Attribution:** **MODEL FAULT**
* **Justification:** The System Prompt explicitly states: *"Hierarchy Awareness: Do not assume nesting. Many effects... have flat structures. **Verify property paths.**"* This instruction implicitly requires the Agent to confirm that a property *can* receive an expression before attempting to set one. `ADBE Vector Stroke Line Cap` and `ADBE Vector Stroke Line Join` are enum/dropdown properties that **do not** support expressions in After Effects—a fact the model should know or verify. The prompt's instruction was present and applicable; the model failed to execute it.

---

#### **Failure B: Fundamental Architectural Mismatch**

* **Observed Failure:** The dashed-stroke approach causes shapes to "dissolve and reassemble" at 90° corners rather than visibly rotating/turning. The user explicitly stated: *"the most important thing to me is getting the effect of a shape that travels a path, and 'turns' rather than shears."*
* **Attribution:** **PROMPT FAULT (Primary) / MODEL FAULT (Secondary)**
* **Justification:**
    * **Prompt Deficiency:** The "Cognitive Process" section requires the Agent to describe how the final render *feels* and plan the *layer architecture*, but it does **not** require explicit validation that the chosen *technical approach* can actually achieve the user's stated behavior. There is no instruction like: *"Before committing to an approach, verify that the chosen technique can physically produce the user's described outcome."*
    * The prompt says *"reject the 'easy' solution in favor of the 'right' solution"*, but this is vague advice, not a procedural gate. The Agent chose the "easy" solution (dashed strokes) without recognizing it was geometrically incapable of delivering the "right" outcome (rotated shapes).
    * **Model Contribution:** Even without an explicit prompt instruction, a true "motion design virtuoso" (as the prompt describes the persona) should recognize that dashed strokes are a texture, not discrete objects, and cannot rotate at vertices. The Agent's "Design Strategy" shows no evidence of this consideration.

---

#### **Failure C: Multiple Non-Functional Controls**

* **Observed Failure:** User reported that `Aspect Ratio`, `Corner Smoothing`, `Reverse Direction`, `Hollow`, and `Core Size` controls did not function or behave as expected.
* **Attribution:** **MODEL FAULT**
* **Justification:** The System Prompt provides no conflicting instructions about how to implement these controls. The Agent simply wrote buggy expressions. For example, `Reverse Direction` checkbox was queried but the expression logic was evidently not working. The `Hollow` stroke's visibility was always on. These are implementation errors, not prompt ambiguities.

---

#### **Failure D: Incomplete Debug Fix (Orphaned Code)**

* **Observed Failure:** After the first "fix," the error persisted because the Agent's SEARCH/REPLACE left an orphaned `lineJoin.expression = lineJoinExpr;` line.
* **Attribution:** **MODEL FAULT**
* **Justification:** This is a precision/attention failure by the model during the patch generation process. The prompt has no bearing on this.

---

## IV. Verdict & Recommendations

**Verdict:** **NEEDS REVISION**

---

### Proposed Revisions to the System Prompt

**Revision 1: Add Explicit Feasibility Gate to Cognitive Process**

The "Think Phase" should require the Agent to validate that its chosen approach can *technically* achieve the user's stated behavior before generating code.

> **Current:**
> ```
> 1. **Visual Visualization:** Describe how the final render feels...
> 2. **Layer Architecture:** Plan the composition structure...
> 3. **Expression Logic:** detailed mental check of the math...
> ```
>
> **Proposed Addition (Insert as Step 1.5 or 2.5):**
> ```
> **Technical Feasibility Check:** Explicitly confirm that the chosen rendering technique (e.g., dashed strokes, repeaters, expression instances) can physically produce the user's described visual behavior. If the technique has inherent geometric limitations (e.g., strokes cannot rotate at vertices), acknowledge this limitation and propose an alternative architecture before proceeding. Do not proceed with an approach that is fundamentally incapable of the goal.
> ```

---

**Revision 2: Add Property Verification Mandate**

Strengthen the "Hierarchy Awareness" rule to be more actionable.

> **Current:**
> ```
> *   **Hierarchy Awareness:** Do not assume nesting. Many effects (like `Color Balance HLS`) have flat structures. Verify property paths.
> ```
>
> **Proposed Revision:**
> ```
> *   **Hierarchy & Capability Awareness:** Do not assume nesting or expression support. Many effects have flat structures. **Enum/dropdown properties (e.g., Line Cap, Line Join, Blend Mode) do not support expressions; set them via `.setValue()` only.** Before assigning an expression to any property, confirm the property type supports expressions.
> ```

---

**Revision 3: Require Alternative Consideration for Complex Requests**

Add to the Cognitive Process or as a standalone directive:

> **Proposed Addition:**
> ```
> **Approach Alternatives:** For any non-trivial animation request, briefly consider at least two potential implementation strategies (e.g., dashed strokes vs. expression-driven instances vs. text-on-path). State which approach you are selecting and why it is superior for the user's specific requirements. If the primary approach has known limitations relevant to the request, disclose them upfront.
> ```

---

**Summary of Root Causes:**

| Failure | Attribution | Fix Location |
|---|---|---|
| Expression on enums | Model Fault | Prompt Revision 2 (explicit rule) |
| Wrong architecture | Prompt Fault (60%) / Model Fault (40%) | Prompt Revisions 1 & 3 |
| Broken controls | Model Fault | N/A (model capability) |
| Orphaned code in patch | Model Fault | N/A (model precision) |

</AUDIT_REPORTS>